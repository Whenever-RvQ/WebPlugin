console.log("ğŸ›¡ï¸ Web Security Guardian Background Service Starting...");class u{maliciousUrls=new Set(["malware-example.com","phishing-test.net","suspicious-site.org","fake-bank.com","scam-lottery.net"]);trackerDomains=new Set(["google-analytics.com","googletagmanager.com","facebook.com","doubleclick.net","googlesyndication.com","amazon-adsystem.com"]);isMalicious(o){try{const t=new URL(o).hostname.toLowerCase();return Array.from(this.maliciousUrls).some(s=>t===s||t.endsWith("."+s))}catch{return!1}}isTracker(o){try{const t=new URL(o).hostname.toLowerCase();return Array.from(this.trackerDomains).some(s=>t===s||t.endsWith("."+s))}catch{return!1}}}const i=new u;chrome.runtime.onInstalled.addListener(e=>{console.log("âœ… Extension installed:",e.reason),e.reason==="install"&&(chrome.storage.local.set({protection_settings:{maliciousUrlProtection:!0,xssProtection:!0,trackerBlocking:!0,formProtection:!0,phishingProtection:!0,notifications:!0,autoUpdate:!0,strictMode:!1},security_stats:{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{malicious_url:0,xss_attack:0,tracker:0,insecure_form:0,suspicious_script:0,phishing:0},threatsByLevel:{low:0,medium:0,high:0,critical:0},lastScanTime:0},whitelist:[],blacklist:[]}),chrome.tabs.create({url:chrome.runtime.getURL("src/options/index.html")}))});chrome.webRequest.onBeforeRequest.addListener(e=>{i.isMalicious(e.url)&&(console.log("ğŸš« Malicious URL detected (blocked by declarativeNetRequest):",e.url),chrome.storage.local.get(["security_stats"],o=>{if(o.security_stats){const t=o.security_stats;t.totalThreats++,t.blockedThreats++,t.threatsByType.malicious_url++,t.threatsByLevel.high++,chrome.storage.local.set({security_stats:t})}})),i.isTracker(e.url)&&(console.log("ğŸ‘ï¸ Tracker request detected (blocked by declarativeNetRequest):",e.url),chrome.storage.local.get(["security_stats"],o=>{if(o.security_stats){const t=o.security_stats;t.totalThreats++,t.blockedThreats++,t.threatsByType.tracker++,t.threatsByLevel.medium++,chrome.storage.local.set({security_stats:t})}}))},{urls:["<all_urls>"]});chrome.runtime.onMessage.addListener((e,o,t)=>{console.log("ğŸ“¨ Received message:",e.type);try{switch(e.type){case"GET_SECURITY_STATUS":return chrome.storage.local.get(["security_stats"],a=>{t({maliciousUrlsCount:a.security_stats?.blockedThreats||0,trackersBlocked:a.security_stats?.threatsByType?.tracker||0})}),!0;case"GET_STATS":return chrome.storage.local.get(["security_stats"],a=>{t(a.security_stats||{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{},threatsByLevel:{},lastScanTime:Date.now()})}),!0;case"UPDATE_SETTINGS":return chrome.storage.local.set({protection_settings:e.data},()=>{t({success:!0})}),!0;case"SETTINGS_UPDATED":console.log("âš™ï¸ Settings updated:",e.data),t({success:!0});break;case"TOGGLE_PROTECTION":console.log("ğŸ”„ Protection toggled:",e.data),t({success:!0});break;case"SCAN_PAGE":console.log("ğŸ” Scanning page:",e.data?.tabId),t({success:!0});break;case"PAGE_NAVIGATION":console.log("ğŸ”„ Page navigation detected, clearing previous threats for:",e.url);let s="";try{s=new URL(e.url).hostname}catch{s=e.url}return chrome.storage.local.get(["threat_history"],a=>{const r=a.threat_history||[],c=r.filter(n=>{try{return new URL(n.url).hostname!==s}catch{return!n.url.includes(s)}});console.log(`ğŸ—‘ï¸ Cleared ${r.length-c.length} threats for ${s}`),chrome.storage.local.set({threat_history:c},()=>{t({success:!0,clearedCount:r.length-c.length})})}),!0;case"THREAT_DETECTED":console.log("ğŸš¨ Threat detected:",e.threat||e.data);const l=e.threat||e.data;chrome.storage.local.get(["security_stats","threat_history"],a=>{const r=a.security_stats||{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{malicious_url:0,xss_attack:0,sql_injection:0,tracker:0,insecure_form:0,suspicious_script:0,phishing:0,data_leak:0},threatsByLevel:{low:0,medium:0,high:0,critical:0},lastScanTime:Date.now()};r.totalThreats++,l.blocked?r.blockedThreats++:r.allowedThreats++,r.threatsByType[l.type]!==void 0&&r.threatsByType[l.type]++,r.threatsByLevel[l.level]!==void 0&&r.threatsByLevel[l.level]++,r.lastScanTime=Date.now();const c=a.threat_history||[];c.unshift(l),c.length>100&&c.splice(100),chrome.storage.local.set({security_stats:r,threat_history:c}),console.log("ğŸ“Š Stats updated:",r)}),t({success:!0});break;case"SECURITY_ISSUE":console.log("âš ï¸ Security issue:",e.issueType,e.data),t({success:!0});break;case"UPDATE_WHITELIST":return console.log("ğŸ“ Updating whitelist:",e.data),chrome.storage.local.set({whitelist:e.data},()=>{console.log("âœ… Whitelist updated successfully"),t({success:!0})}),!0;case"GET_WHITELIST":return chrome.storage.local.get(["whitelist"],a=>{console.log("ğŸ“‹ Getting whitelist:",a.whitelist),t({whitelist:a.whitelist||[]})}),!0;case"UPDATE_BLACKLIST":return console.log("ğŸ“ Updating blacklist:",e.data),chrome.storage.local.set({blacklist:e.data},()=>{console.log("âœ… Blacklist updated successfully"),t({success:!0})}),!0;case"GET_BLACKLIST":return chrome.storage.local.get(["blacklist"],a=>{console.log("ğŸ“‹ Getting blacklist:",a.blacklist),t({blacklist:a.blacklist||[]})}),!0;default:t({success:!0})}}catch(s){console.error("âŒ Error handling message:",s),t({error:String(s)})}return!0});chrome.tabs.onUpdated.addListener((e,o,t)=>{o.status==="complete"&&t.url&&(console.log("ğŸ“„ Page loaded:",t.url),i.isMalicious(t.url)&&console.log("âš ï¸ Warning: Potentially malicious page"))});chrome.webRequest.onHeadersReceived.addListener(e=>{console.log("ğŸ” Headers received from:",e.url)},{urls:["<all_urls>"]});console.log("âœ… Web Security Guardian Background Service Started Successfully");let h=0;setInterval(()=>{h++,console.log(`ğŸ’“ Service Worker heartbeat #${h}`)},3e4);
