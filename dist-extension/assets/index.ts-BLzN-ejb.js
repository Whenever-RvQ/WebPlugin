import{d as h,T as a,i as M,a as C,b as c,c as L,e as $,g as _,f as R}from"./security-6RDsp77e.js";class A{observer=null;threatCallback;initialize(){this.setupDOMObserver(),console.log("ğŸ‘ï¸ DOM Observer initialized")}setThreatCallback(e){this.threatCallback=e}setupDOMObserver(){this.observer=new MutationObserver(e=>{e.forEach(t=>{this.handleMutation(t)})}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src","href","onclick","onload","onerror"],characterData:!0})}handleMutation(e){switch(e.type){case"childList":this.handleChildListMutation(e);break;case"attributes":this.handleAttributeMutation(e);break;case"characterData":this.handleCharacterDataMutation(e);break}}handleChildListMutation(e){e.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&this.analyzeAddedElement(t)})}handleAttributeMutation(e){const t=e.target,i=e.attributeName;if(!i)return;const n=t.getAttribute(i);n&&this.isDangerousAttribute(i,n)&&this.reportThreat({id:`dangerous_attribute_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å±é™©å±æ€§: ${i}="${n.substring(0,50)}"`,timestamp:Date.now(),blocked:!1,details:{element:t.tagName,attribute:i,value:n.substring(0,200)}})}handleCharacterDataMutation(e){const i=e.target.textContent||"",n=h(i);n.detected&&this.reportThreat({id:`text_xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"medium",url:window.location.href,description:"æ£€æµ‹åˆ°æ–‡æœ¬å†…å®¹ä¸­çš„XSSæ¨¡å¼",timestamp:Date.now(),blocked:!1,details:{content:i.substring(0,200),patterns:n.patterns.map(s=>s.id)}})}analyzeAddedElement(e){e.tagName==="SCRIPT"&&this.analyzeScriptElement(e),e.tagName==="IFRAME"&&this.analyzeIframeElement(e),e.tagName==="FORM"&&this.analyzeFormElement(e);const t=e.innerHTML;if(t){const i=h(t);i.detected&&this.reportThreat({id:`dynamic_xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"high",url:window.location.href,description:"æ£€æµ‹åˆ°åŠ¨æ€æ·»åŠ çš„XSSå†…å®¹",timestamp:Date.now(),blocked:!1,details:{element:e.tagName,content:t.substring(0,200),patterns:i.patterns.map(n=>n.id)}})}e.querySelectorAll("*").forEach(i=>{this.analyzeAddedElement(i)})}analyzeScriptElement(e){const t=e.src,i=e.textContent||e.innerHTML;t?this.isTrustedDomain(t)||this.reportThreat({id:`dynamic_external_script_${Date.now()}`,type:"suspicious_script",level:"high",url:window.location.href,description:`åŠ¨æ€åŠ è½½å¤–éƒ¨è„šæœ¬: ${new URL(t).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:t}}):i&&this.reportThreat({id:`dynamic_inline_script_${Date.now()}`,type:"suspicious_script",level:"high",url:window.location.href,description:"åŠ¨æ€æ·»åŠ å†…è”è„šæœ¬",timestamp:Date.now(),blocked:!1,details:{content:i.substring(0,200)}})}analyzeIframeElement(e){const t=e.src;t&&!this.isTrustedDomain(t)&&this.reportThreat({id:`dynamic_iframe_${Date.now()}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`åŠ¨æ€æ·»åŠ å¤–éƒ¨iframe: ${new URL(t).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:t}})}analyzeFormElement(e){const t=e.action;if(t&&t!==window.location.href)try{const i=new URL(t),n=new URL(window.location.href);i.hostname!==n.hostname&&this.reportThreat({id:`dynamic_cross_domain_form_${Date.now()}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`åŠ¨æ€æ·»åŠ è·¨åŸŸè¡¨å•: ${i.hostname}`,timestamp:Date.now(),blocked:!1,details:{action:t}})}catch{}}isDangerousAttribute(e,t){return e.startsWith("on")||(e==="src"||e==="href")&&t.startsWith("javascript:")?!0:h(t).detected}isTrustedDomain(e){try{const t=new URL(e).hostname;return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","cdn.jsdelivr.net","unpkg.com","jsdelivr.net","twimg.com","abs.twimg.com","pbs.twimg.com","ton.twimg.com","facebook.net","fbcdn.net","gstatic.com","googleusercontent.com","cloudflare.com","cloudflareinsights.com","cloudfront.net"].some(n=>t===n||t.endsWith("."+n))}catch{return!1}}reportThreat(e){this.threatCallback&&this.threatCallback(e)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null)}}class U{formListeners=new Map;threatCallback;initialize(){console.log("ğŸ“ Form Monitor initialized"),this.setupFormMonitoring()}setThreatCallback(e){this.threatCallback=e}setupFormMonitoring(){document.addEventListener("submit",t=>{t.target instanceof HTMLFormElement&&this.onFormSubmit(t)},!0),new MutationObserver(t=>{t.forEach(i=>{i.addedNodes.forEach(n=>{n instanceof HTMLFormElement?this.monitorForm(n):n instanceof HTMLElement&&n.querySelectorAll("form").forEach(s=>this.monitorForm(s))})})}).observe(document.body,{childList:!0,subtree:!0})}monitorForm(e){if(this.formListeners.has(e))return;const t=i=>{this.onFormSubmit(i)};e.addEventListener("submit",t,!0),this.formListeners.set(e,t)}onFormSubmit(e){const t=e.target,i=this.analyzeFormSubmit(t);if(i.length===0)return;i.some(s=>s.level===a.CRITICAL||s.level===a.HIGH)&&(e.preventDefault(),this.showWarning(i),this.reportThreats(i))}showWarning(e){const t=e.map(i=>`â€¢ ${i.description}`).join(`
`);console.warn(`âš ï¸ æ£€æµ‹åˆ°å®‰å…¨å¨èƒï¼š

${t}

ä¸ºäº†æ‚¨çš„å®‰å…¨ï¼Œè¡¨å•æäº¤å·²è¢«é˜»æ­¢ã€‚`)}reportThreats(e){typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({type:"THREAT_DETECTED",threats:e}).catch(t=>console.error("Failed to report threats:",t)),this.emitThreats(e)}emitThreats(e){this.threatCallback&&e.forEach(t=>this.threatCallback?.(t))}async scanForms(){const e=[];return document.querySelectorAll("form").forEach((i,n)=>{const s=this.analyzeForm(i,n);e.push(...s)}),e}async checkFormSecurity(e){return M(e)}analyzeFormSubmit(e){const t=[],i=new FormData(e);for(const[n,s]of i.entries()){if(typeof s!="string")continue;const r=C(s);r.detected&&r.patterns.forEach(d=>{t.push({id:`sql_injection_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:c.SQL_INJECTION,level:d.severity,url:window.location.href,description:`è¡¨å•å­—æ®µ "${n}" åŒ…å«SQLæ³¨å…¥æ”»å‡»: ${d.description}`,timestamp:Date.now(),blocked:!0,details:{field:n,value:s.substring(0,100),pattern:d.id}})});const l=h(s);l.detected&&l.patterns.forEach(d=>{t.push({id:`xss_form_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:c.XSS_ATTACK,level:d.severity,url:window.location.href,description:`è¡¨å•å­—æ®µ "${n}" åŒ…å«XSSæ”»å‡»: ${d.description}`,timestamp:Date.now(),blocked:!0,details:{field:n,value:s.substring(0,100),pattern:d.id}})});const m=L(s);m.detected&&!e.action.startsWith("https://")&&t.push({id:`sensitive_data_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:c.INSECURE_FORM,level:a.HIGH,url:window.location.href,description:`è¡¨å•åœ¨éHTTPSè¿æ¥ä¸‹ä¼ è¾“æ•æ„Ÿä¿¡æ¯: ${m.types.join(", ")}`,timestamp:Date.now(),blocked:!0,details:{field:n,types:m.types}})}return t}analyzeForm(e,t){const i=[],n=e.action||window.location.href,s=e.method.toLowerCase();if(s==="post"&&!n.startsWith("https://")){const r=e.querySelector('input[type="password"]'),l=this.hasSensitiveFields(e);(r||l)&&i.push({id:`insecure_form_${Date.now()}_${t}`,type:c.INSECURE_FORM,level:a.HIGH,url:window.location.href,description:"è¡¨å•åŒ…å«æ•æ„Ÿä¿¡æ¯ä½†æœªä½¿ç”¨HTTPSæäº¤",timestamp:Date.now(),blocked:!1,details:{action:n,method:s,hasPassword:!!r,hasSensitiveFields:l}})}if(n&&n!==window.location.href)try{const r=new URL(n),l=new URL(window.location.href);r.hostname!==l.hostname&&i.push({id:`cross_domain_form_${Date.now()}_${t}`,type:c.SUSPICIOUS_SCRIPT,level:a.MEDIUM,url:window.location.href,description:`è¡¨å•æäº¤åˆ°å¤–éƒ¨åŸŸå: ${r.hostname}`,timestamp:Date.now(),blocked:!1,details:{action:n,targetDomain:r.hostname}})}catch{i.push({id:`invalid_form_action_${Date.now()}_${t}`,type:c.SUSPICIOUS_SCRIPT,level:a.MEDIUM,url:window.location.href,description:"è¡¨å•actionåŒ…å«æ— æ•ˆURL",timestamp:Date.now(),blocked:!1,details:{action:n}})}return i}hasSensitiveFields(e){const t=e.querySelectorAll("input, textarea"),i=[/password/i,/credit.*card/i,/social.*security/i,/ssn/i,/é“¶è¡Œå¡/i,/å¯†ç /i,/èº«ä»½è¯/i,/phone/i,/email/i,/address/i];for(const n of t){const s=n,r=`${s.name} ${s.placeholder} ${s.id}`.toLowerCase();if(i.some(l=>l.test(r))||s instanceof HTMLInputElement&&["password","email","tel"].includes(s.type))return!0}return!1}}class z{suspiciousPatterns=[/eval\s*\(/gi,/document\.write\s*\(/gi,/innerHTML\s*=.*<script/gi,/location\.href\s*=/gi,/window\.open\s*\(/gi,/document\.cookie/gi,/localStorage\./gi,/sessionStorage\./gi];threatCallback;initialize(){console.log("ğŸ“œ Script Monitor initialized"),this.setupRealTimeMonitoring(),this.interceptDangerousFunctions()}setThreatCallback(e){this.threatCallback=e}setupRealTimeMonitoring(){new MutationObserver(t=>{t.forEach(i=>{i.addedNodes.forEach(n=>{n.nodeName==="SCRIPT"&&this.handleDynamicScript(n)})})}).observe(document.documentElement,{childList:!0,subtree:!0})}handleDynamicScript(e){e.src?this.analyzeExternalScript(e,0).forEach(t=>{this.reportThreat(t)}):e.textContent&&this.analyzeInlineScript(e,0).forEach(t=>{this.reportThreat(t)})}interceptDangerousFunctions(){try{const e=document.createElement("script");e.textContent=`
        (function() {
          // ä¿å­˜åŸå§‹å‡½æ•°
          const originalEval = window.eval;
          const originalFunction = window.Function;
          const originalSetTimeout = window.setTimeout;
          const originalSetInterval = window.setInterval;
          
          // æ‹¦æˆªeval
          window.eval = function(...args) {
            console.warn('ğŸš¨ eval() è¢«è°ƒç”¨:', args[0]?.substring(0, 100));
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'eval',
              args: args[0]?.substring(0, 200),
              stack: new Error().stack
            }, '*');
            return originalEval.apply(this, args);
          };
          
          // æ‹¦æˆªFunctionæ„é€ å‡½æ•°
          window.Function = new Proxy(originalFunction, {
            construct(target, args) {
              console.warn('ğŸš¨ Function() è¢«è°ƒç”¨:', args);
              window.postMessage({
                type: 'WEB_SEC_GUARDIAN_ALERT',
                function: 'Function',
                args: JSON.stringify(args).substring(0, 200),
                stack: new Error().stack
              }, '*');
              return new target(...args);
            }
          });
          
          // æ‹¦æˆªsetTimeoutä¸­çš„å­—ç¬¦ä¸²
          window.setTimeout = function(handler, ...args) {
            if (typeof handler === 'string') {
              console.warn('ğŸš¨ setTimeoutæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç :', handler.substring(0, 100));
              window.postMessage({
                type: 'WEB_SEC_GUARDIAN_ALERT',
                function: 'setTimeout',
                args: handler.substring(0, 200)
              }, '*');
            }
            return originalSetTimeout.call(this, handler, ...args);
          };
          
          // æ‹¦æˆªsetIntervalä¸­çš„å­—ç¬¦ä¸²
          window.setInterval = function(handler, ...args) {
            if (typeof handler === 'string') {
              console.warn('ğŸš¨ setIntervalæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç :', handler.substring(0, 100));
              window.postMessage({
                type: 'WEB_SEC_GUARDIAN_ALERT',
                function: 'setInterval',
                args: handler.substring(0, 200)
              }, '*');
            }
            return originalSetInterval.call(this, handler, ...args);
          };
          
          console.log('ğŸ›¡ï¸ Web Security Guardian - å±é™©å‡½æ•°ç›‘æ§å·²æ¿€æ´»');
        })();
      `,(document.head||document.documentElement).insertBefore(e,(document.head||document.documentElement).firstChild),e.remove()}catch{}window.addEventListener("message",e=>{if(e.source===window&&e.data.type==="WEB_SEC_GUARDIAN_ALERT"){const t={id:`dangerous_function_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:c.XSS_ATTACK,level:a.HIGH,url:window.location.href,description:`æ£€æµ‹åˆ°å±é™©å‡½æ•°è°ƒç”¨: ${e.data.function}()`,timestamp:Date.now(),blocked:!1,details:{function:e.data.function,args:e.data.args,stack:e.data.stack}};this.reportThreat(t)}})}reportThreat(e){this.threatCallback&&this.threatCallback(e),typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({type:"THREAT_DETECTED",threat:e}).catch(t=>console.error("Failed to report threat:",t))}async scanScripts(){const e=[];return document.querySelectorAll("script:not([src])").forEach((n,s)=>{const r=this.analyzeInlineScript(n,s);e.push(...r)}),document.querySelectorAll("script[src]").forEach((n,s)=>{const r=this.analyzeExternalScript(n,s);e.push(...r)}),e}analyzeInlineScript(e,t){const i=[],n=e.textContent||e.innerHTML||"";if(!n.trim())return i;const s=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.startsWith("192.168.");return s&&e.hasAttribute("type")&&e.getAttribute("type")==="module"||(s||this.suspiciousPatterns.forEach((r,l)=>{const m=n.match(r);m&&i.push({id:`suspicious_inline_script_${Date.now()}_${t}_${l}`,type:c.SUSPICIOUS_SCRIPT,level:this.getPatternSeverity(r),url:window.location.href,description:`å†…è”è„šæœ¬åŒ…å«å¯ç–‘ä»£ç : ${this.getPatternDescription(r)}`,timestamp:Date.now(),blocked:!1,details:{pattern:r.toString(),matches:m.slice(0,3),scriptContent:n.substring(0,200)}})}),n.length>1e4&&this.isObfuscated(n)&&i.push({id:`obfuscated_script_${Date.now()}_${t}`,type:c.SUSPICIOUS_SCRIPT,level:a.MEDIUM,url:window.location.href,description:"æ£€æµ‹åˆ°å¯èƒ½çš„æ··æ·†è„šæœ¬ä»£ç ",timestamp:Date.now(),blocked:!1,details:{scriptLength:n.length,scriptPreview:n.substring(0,100)}})),i}analyzeExternalScript(e,t){const i=[],n=e.src;if(!n)return i;try{const s=new URL(n);this.isTrustedDomain(s.hostname)||i.push({id:`untrusted_external_script_${Date.now()}_${t}`,type:c.SUSPICIOUS_SCRIPT,level:a.MEDIUM,url:window.location.href,description:`åŠ è½½æ¥è‡ªä¸å¯ä¿¡åŸŸåçš„è„šæœ¬: ${s.hostname}`,timestamp:Date.now(),blocked:!1,details:{src:n,domain:s.hostname}}),s.protocol==="http:"&&window.location.protocol==="https:"&&i.push({id:`mixed_content_script_${Date.now()}_${t}`,type:c.INSECURE_FORM,level:a.MEDIUM,url:window.location.href,description:"HTTPSé¡µé¢åŠ è½½HTTPè„šæœ¬ï¼ˆæ··åˆå†…å®¹ï¼‰",timestamp:Date.now(),blocked:!1,details:{src:n}})}catch{i.push({id:`invalid_script_src_${Date.now()}_${t}`,type:c.SUSPICIOUS_SCRIPT,level:a.HIGH,url:window.location.href,description:"è„šæœ¬srcåŒ…å«æ— æ•ˆURL",timestamp:Date.now(),blocked:!1,details:{src:n}})}return i}getPatternSeverity(e){const t=e.toString();return t.includes("eval")?a.HIGH:t.includes("document.write")?a.MEDIUM:t.includes("innerHTML.*<script")?a.HIGH:t.includes("location.href")?a.MEDIUM:t.includes("document.cookie")?a.MEDIUM:a.LOW}getPatternDescription(e){const t=e.toString();return t.includes("eval")?"eval()å‡½æ•°è°ƒç”¨":t.includes("document.write")?"document.write()è°ƒç”¨":t.includes("innerHTML.*<script")?"innerHTMLæ³¨å…¥è„šæœ¬":t.includes("location.href")?"é¡µé¢é‡å®šå‘":t.includes("document.cookie")?"Cookieè®¿é—®":t.includes("localStorage")?"localStorageè®¿é—®":t.includes("sessionStorage")?"sessionStorageè®¿é—®":"å¯ç–‘ä»£ç æ¨¡å¼"}isObfuscated(e){return[/[a-zA-Z_$][a-zA-Z0-9_$]*\s*=\s*['"]\w+['"]/.test(e),e.split(`
`).length<10&&e.length>5e3,/\\x[0-9a-fA-F]{2}/.test(e),/\\u[0-9a-fA-F]{4}/.test(e),(e.match(/[{}]/g)||[]).length>e.length*.1].filter(Boolean).length>=2}isTrustedDomain(e){return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","unpkg.com","jsdelivr.net","stackpath.bootstrapcdn.com","maxcdn.bootstrapcdn.com","fonts.googleapis.com","use.fontawesome.com","cdn.jsdelivr.net","unpkg.com","twimg.com","abs.twimg.com","pbs.twimg.com","ton.twimg.com","facebook.net","fbcdn.net","youtube.com","ytimg.com","googlevideo.com","gstatic.com","ggpht.com","googleusercontent.com","recaptcha.net","cloudflare.com","cloudflareinsights.com","akamaized.net","fastly.net","amazonaws.com","s3.amazonaws.com","cloudfront.net"].some(i=>e===i||e.endsWith("."+i))}}class F{threats=[];initialize(){console.log("ğŸ“Š Page Analyzer initialized")}async scanPage(){return this.threats=[],await this.scanContent(),await this.scanExternalResources(),await this.scanUrl(),this.threats}async analyzePage(){const e=await this.scanPage(),t=$(e);return{url:window.location.href,score:t,threats:e,recommendations:this.generateRecommendations(e),scanTime:Date.now(),isSecure:e.length===0}}async scanContent(){const e=document.documentElement.innerHTML,t=h(e);t.detected&&t.patterns.forEach(i=>{this.threats.push({id:`xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:i.severity,url:window.location.href,description:`æ£€æµ‹åˆ°XSSæ¨¡å¼: ${i.description}`,timestamp:Date.now(),blocked:!1,details:{pattern:i.id}})})}async scanExternalResources(){document.querySelectorAll("script[src]").forEach(i=>{const n=i.src;n&&!this.isTrustedDomain(n)&&this.threats.push({id:`external_script_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å¤–éƒ¨è„šæœ¬: ${new URL(n).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:n}})}),document.querySelectorAll("iframe[src]").forEach(i=>{const n=i.src;n&&!this.isTrustedDomain(n)&&this.threats.push({id:`external_iframe_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å¤–éƒ¨iframe: ${new URL(n).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:n}})})}async scanUrl(){const e=window.location.href;!e.startsWith("https://")&&!e.startsWith("file://")&&this.threats.push({id:`insecure_protocol_${Date.now()}`,type:"insecure_form",level:"medium",url:e,description:"ç½‘ç«™æœªä½¿ç”¨HTTPSåŠ å¯†è¿æ¥",timestamp:Date.now(),blocked:!1})}isTrustedDomain(e){try{const t=new URL(e).hostname;return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","unpkg.com","jsdelivr.net","cdn.jsdelivr.net","twimg.com","abs.twimg.com","pbs.twimg.com","ton.twimg.com","facebook.net","fbcdn.net","gstatic.com","googleusercontent.com","cloudflare.com","cloudflareinsights.com","cloudfront.net"].some(n=>t===n||t.endsWith("."+n))}catch{return!1}}generateRecommendations(e){const t=[],i=new Set(e.map(n=>n.type));return i.has("xss_attack")&&t.push("æ£€æµ‹åˆ°XSSé£é™©ï¼Œå»ºè®®æ›´æ–°æµè§ˆå™¨å¹¶å¯ç”¨å®‰å…¨é˜²æŠ¤"),i.has("suspicious_script")&&t.push("å‘ç°å¯ç–‘å¤–éƒ¨èµ„æºï¼Œè¯·ç¡®è®¤ç½‘ç«™å¯ä¿¡åº¦"),i.has("insecure_form")&&t.push("ç½‘ç«™æœªä½¿ç”¨HTTPSï¼Œé¿å…è¾“å…¥æ•æ„Ÿä¿¡æ¯"),t.length===0&&t.push("é¡µé¢å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼Œä½†ä»éœ€ä¿æŒè­¦æƒ•"),t}}console.log("ğŸ›¡ï¸ Web Security Guardian å†…å®¹è„šæœ¬å¯åŠ¨:",window.location.href);const b=new A,S=new U,T=new z,H=new F,v=new Set,f=[];let g=!1,w=null,u=!1;async function P(){try{const o=window.location.hostname,e=await chrome.storage.local.get(["whitelist"]);let t=[];return e.whitelist&&Array.isArray(e.whitelist)&&(t=e.whitelist),console.log("ğŸ” ç™½åå•æ£€æŸ¥:",{å½“å‰åŸŸå:o,ç™½åå•æ•°é‡:t.length}),t.length===0?(u=!1,!1):(u=t.some(i=>o===i||o.endsWith(`.${i}`)),u&&(console.log("âœ… å½“å‰ç½‘ç«™åœ¨ç™½åå•ä¸­ï¼Œå·²ç¦ç”¨æ‰€æœ‰å®‰å…¨æ£€æµ‹"),O()),u)}catch(o){return console.error("âŒ æ£€æŸ¥ç™½åå•å¤±è´¥:",o),u=!1,!1}}function O(){if(!document.body)return;const o=document.createElement("div");o.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:32px 40px;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:2147483647;text-align:center;min-width:400px",o.innerHTML='<div style="font-size:48px;margin-bottom:16px">âœ…</div><h2 style="margin:0 0 12px;font-size:24px;font-weight:700">ç™½åå•ç½‘ç«™</h2><p style="margin:0 0 24px;font-size:14px;opacity:0.8">å½“å‰ç½‘ç«™å·²åŠ å…¥ç™½åå•<br>æ‰€æœ‰å®‰å…¨æ£€æµ‹åŠŸèƒ½å·²ç¦ç”¨</p><button onclick="this.parentElement.remove()" style="background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.4);color:white;padding:12px 32px;border-radius:8px;font-size:14px;cursor:pointer">æˆ‘çŸ¥é“äº†</button>';const e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:2147483646",e.onclick=()=>{o.remove(),e.remove()},document.body.appendChild(e),document.body.appendChild(o),setTimeout(()=>{o.parentElement&&(o.remove(),e.remove())},3e3)}function D(){return typeof chrome<"u"&&!!chrome.runtime?.sendMessage}function N(o){D()&&(v.has(o.id)||(v.add(o.id),chrome.runtime.sendMessage({type:"THREAT_DETECTED",threat:o}).catch(e=>console.error("Failed to notify background:",e))))}function k(o){switch(o){case c.MALICIOUS_URL:return"æ¶æ„ç½‘å€";case c.XSS_ATTACK:return"XSSæ”»å‡»";case c.SQL_INJECTION:return"SQLæ³¨å…¥";case c.TRACKER:return"è¿½è¸ªå™¨";case c.INSECURE_FORM:return"ä¸å®‰å…¨ä¼ è¾“";case c.SUSPICIOUS_SCRIPT:return"å¯ç–‘è„šæœ¬";case c.PHISHING:return"é’“é±¼é£é™©";case c.DATA_LEAK:return"æ•æ„Ÿä¿¡æ¯æ³„éœ²";default:return"å®‰å…¨è­¦å‘Š"}}function W(o){switch(o){case a.CRITICAL:return"linear-gradient(135deg, #ff1744, #b71c1c)";case a.HIGH:return"linear-gradient(135deg, #ff6b6b, #d32f2f)";case a.MEDIUM:return"linear-gradient(135deg, #ffb74d, #f57c00)";case a.LOW:return"linear-gradient(135deg, #66bb6a, #2e7d32)";default:return"linear-gradient(135deg, #607d8b, #455a64)"}}function x(o){if(!document.body){f.push(o);return}let e=o.url;try{e=new URL(o.url).hostname}catch{}const t="wsg-threat-container";let i=document.getElementById(t);i||(i=document.createElement("div"),i.id=t,i.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 2147483647;
      max-width: 380px;
      pointer-events: none;
    `,document.body.appendChild(i));const n=document.createElement("div");n.style.cssText=`
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 18px 20px;
    border-radius: 16px;
    color: #fff;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08);
    background: ${W(o.level)};
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    pointer-events: auto;
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateX(400px) scale(0.9);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    backdrop-filter: blur(10px);
  `;const s=document.createElement("div");if(s.style.cssText=`
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 3s infinite;
  `,n.appendChild(s),n.innerHTML+=`
    <div style="font-size: 24px; line-height: 1; animation: bounce 0.6s ease;">ğŸ›¡ï¸</div>
    <div style="flex: 1; min-width: 0;">
      <div style="font-weight: 700; font-size: 14px; margin-bottom: 6px; letter-spacing: 0.3px;">
        ${k(o.type)} Â· ${o.level.toUpperCase()}
      </div>
      <div style="font-size: 13px; word-break: break-word; line-height: 1.6; opacity: 0.95;">${o.description}</div>
      <div style="margin-top: 8px; font-size: 11px; opacity: 0.8; font-weight: 500;">
        ğŸ“ ${e}
      </div>
    </div>
    <button type="button" aria-label="å…³é—­è­¦å‘Š"
      style="background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 20px; cursor: pointer; line-height: 1; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;">Ã—</button>
  `,!document.getElementById("wsg-toast-animations")){const l=document.createElement("style");l.id="wsg-toast-animations",l.textContent=`
      @keyframes shine {
        0% { left: -100%; }
        50% { left: 100%; }
        100% { left: 100%; }
      }
      @keyframes bounce {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
      }
    `,document.head.appendChild(l)}const r=n.querySelector("button");r?.addEventListener("mouseenter",()=>{r instanceof HTMLElement&&(r.style.background="rgba(255,255,255,0.3)",r.style.transform="scale(1.1)")}),r?.addEventListener("mouseleave",()=>{r instanceof HTMLElement&&(r.style.background="rgba(255,255,255,0.2)",r.style.transform="scale(1)")}),r?.addEventListener("click",l=>{l.stopPropagation(),n.style.opacity="0",n.style.transform="translateX(400px) scale(0.8)",setTimeout(()=>n.remove(),400)}),i.appendChild(n),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateX(0) scale(1)"})}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(400px) scale(0.8)",setTimeout(()=>n.remove(),400)},6e3)}function G(){if(!f.length)return;const o=[...f];f.length=0,o.forEach(x)}function p(o,e={}){u||(console.warn("ğŸš¨ å¨èƒæ£€æµ‹:",{ç±»å‹:k(o.type),ç­‰çº§:o.level.toUpperCase(),æè¿°:o.description,è¯¦æƒ…:o.details}),x(o),e.notifyBackground&&N(o))}const y=document.createElement("meta");y.name="web-security-guardian";y.content="active";document.head?.appendChild(y);window.webSecurityGuardian={version:"1.0.0",isActive:!0,reportThreat:o=>{const e={id:o.id||_(),type:o.type||c.DATA_LEAK,level:o.level||a.MEDIUM,url:o.url||window.location.href,description:o.description||"æ£€æµ‹åˆ°æœªçŸ¥å®‰å…¨å¨èƒ",timestamp:o.timestamp||Date.now(),blocked:o.blocked??!1,details:o.details};p(e,{notifyBackground:!0})}};function I(o,e){try{const t=new URL(o,window.location.href).href,i=R(t);if(i.detected){const n={id:_(),type:c.PHISHING,level:i.score>=80?a.CRITICAL:a.HIGH,url:t,description:`æ£€æµ‹åˆ°ç–‘ä¼¼é’“é±¼é“¾æ¥ï¼ˆæ¥æºï¼š${e}ï¼‰`,timestamp:Date.now(),blocked:!0,details:{reasons:i.reasons,score:i.score,source:e}};return p(n,{notifyBackground:!0}),console.warn("ğŸ£ é’“é±¼é£é™©è¯¦æƒ…:",i.reasons),!0}}catch(t){console.warn("æ— æ³•è§£æURLè¿›è¡Œå®‰å…¨æ£€æŸ¥:",o,t)}return!1}function j(){document.addEventListener("click",o=>{if(!(o.target instanceof Element))return;const e=o.target.closest("a[href]");if(!e)return;const t=e.href;I(t,"anchor_click")&&(o.preventDefault(),o.stopImmediatePropagation())},!0)}function q(){const o=window.open;window.open=function(...e){const t=e[0],i=typeof t=="string"?t:t?.toString?.();return typeof i=="string"&&I(i,"window.open")?null:o.apply(window,e)}}async function E(){if(G(),await P()){console.log("â¸ï¸ ç™½åå•ç½‘ç«™ï¼Œå·²ç¦ç”¨æ‰€æœ‰å®‰å…¨æ£€æµ‹");return}D()&&chrome.runtime.sendMessage({type:"PAGE_NAVIGATION",url:window.location.href}).then(n=>{n?.clearedCount>0&&console.log(`ğŸ—‘ï¸ å·²æ¸…é™¤ ${n.clearedCount} æ¡å†å²å¨èƒï¼Œå¼€å§‹é‡æ–°è¯„ä¼°`)}).catch(n=>console.error("Failed to notify page navigation:",n));let e=!1;function t(){e||(e=!0,b.setThreatCallback(n=>p(n,{notifyBackground:!0})),b.initialize(),S.setThreatCallback(n=>p(n,{notifyBackground:!0})),S.initialize(),T.setThreatCallback(n=>p(n,{notifyBackground:!0})),T.initialize(),console.log("âœ… ç›‘æ§å™¨å·²å¯åŠ¨"))}function i(){u||(g||(g=!0,console.log("ğŸ‘† æ£€æµ‹åˆ°ç”¨æˆ·äº¤äº’ï¼Œå¯åŠ¨ç›‘æ§"),t()),w&&clearTimeout(w),w=window.setTimeout(()=>{g=!1,console.log("â¸ï¸ ç”¨æˆ·äº¤äº’è¶…æ—¶ï¼Œæš‚åœç›‘æ§")},5e3))}document.addEventListener("click",i,!0),document.addEventListener("submit",i,!0),document.addEventListener("keydown",n=>{n.key==="Enter"&&i()},!0),H.initialize(),j(),console.log("âœ… Web Security Guardian å†…å®¹è„šæœ¬å·²æ¿€æ´»ï¼ˆå®æ—¶ç›‘æ§æ¨¡å¼ï¼‰")}q();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();
